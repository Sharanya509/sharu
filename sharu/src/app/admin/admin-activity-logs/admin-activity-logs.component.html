<div class="admin-logs-container">
    <h2>All Employee Activities Logged</h2>

    <div *ngIf="error" class="error-message">{{ error }}</div>

    <div *ngIf="insights && !isLoadingInsights" class="insights-summary-grid">
        <div class="insight-card total-logs">
            <h4>Total Logs</h4>
            <p class="metric">{{ insights.totalLogs | number }}</p>
        </div>
        <div class="insight-card total-hours">
            <h4>Total Hours Ever</h4>
            <p class="metric">{{ insights.totalHoursLoggedEver | number:'1.1-1' }} hrs</p>
        </div>
        <div class="insight-card top-activities">
            <h4>Top Activity</h4>
            <p class="metric-text">{{ insights.topActivities[0]?._id || 'N/A' }}</p>
        </div>
    </div>
    <div *ngIf="isLoadingInsights" class="loading-message">Loading insights...</div>

    <div class="filter-bar">
        <div class="filter-group">
            <label for="search">Search Employee/Action:</label>
            <input id="search" [(ngModel)]="filterText" (ngModelChange)="applyFilters()"
                placeholder="Name or Activity Type" class="filter-input">
        </div>

        <div class="filter-group">
            <label for="hours-filter">Hours Spent Category:</label>
            <select id="hours-filter" [(ngModel)]="filterHours" (ngModelChange)="applyFilters()" class="filter-select">
                <option value="all">All Hours</option>
                <option value="high">High Effort (> 6 hrs)</option>
                <option value="low">Low Effort (< 2 hrs)</option>
            </select>
        </div>
        <div class="log-count">
            Displaying {{ filteredLogs.length | number }} of {{ allLogs.length | number }} logs.
        </div>
    </div>

    <div class="logs-table-wrapper">
        <table class="logs-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Employee</th>
                    <th>Action</th>
                    <th>Hours</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngIf="isLoadingLogs">
                    <td colspan="5" class="loading-row">Loading detailed log entries...</td>
                </tr>
                <tr *ngFor="let log of filteredLogs" [class.low-effort]="log.hours < 2"
                    [class.high-effort]="log.hours > 6">
                    <td>{{ log.timestamp | date:'medium' }}</td>
                    <td>
                        <strong>{{ log.userId.name }}</strong><br>
                        <span class="employee-id">{{ log.userId.employeeId }}</span>
                    </td>
                    <td class="log-action-cell">{{ log.action }}</td>
                    <td class="log-hours-cell">{{ log.hours | number:'1.1-1' }} hrs</td>
                    <td class="log-details-cell">{{ log.details }}</td>
                </tr>
                <tr *ngIf="filteredLogs.length === 0 && !isLoadingLogs">
                    <td colspan="5" class="no-results-row">No activity logs match the current filters.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>